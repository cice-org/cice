# Cice é¡¹ç›®ç»“æ„ - Phase 2 å®Œæˆå

```
cice/
â”‚
â”œâ”€â”€ ğŸ“ crates/
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“¦ cice-core/                    # æ ¸å¿ƒæ¨¡å— (Phase 1) âœ…
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ runtime/                 # Runtime trait å®šä¹‰
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ mod.rs              # Runtime trait
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ext/                # Runtime æ‰©å±•
â”‚   â”‚   â”‚   â”œâ”€â”€ action/                  # Action trait å®šä¹‰
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ mod.rs              # Action trait
â”‚   â”‚   â”‚   â”œâ”€â”€ context/                 # Context å®ç°
â”‚   â”‚   â”‚   â”œâ”€â”€ task/                    # Task å®ç°
â”‚   â”‚   â”‚   â””â”€â”€ lib.rs
â”‚   â”‚   â””â”€â”€ Cargo.toml
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“¦ cice-runtimes/                # Runtime å®ç° (Phase 2) âœ¨ æ–°å¢
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ ğŸ“¦ cice-runtime-vnc/         # VNC Runtime
â”‚   â”‚       â”œâ”€â”€ src/
â”‚   â”‚       â”‚   â””â”€â”€ lib.rs               # VncRuntime å®ç°
â”‚   â”‚       â”‚                            # - è¿æ¥ç®¡ç†
â”‚   â”‚       â”‚                            # - å±å¹•æ“ä½œ
â”‚   â”‚       â”‚                            # - é¼ æ ‡é”®ç›˜æ§åˆ¶
â”‚   â”‚       â”œâ”€â”€ Cargo.toml
â”‚   â”‚       â””â”€â”€ README.md
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“¦ cice-actions/                 # Action å®ç° (Phase 2) âœ¨ æ–°å¢
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ ğŸ“¦ cice-action-opencv/       # OpenCV Actions
â”‚   â”‚       â”œâ”€â”€ src/
â”‚   â”‚       â”‚   â”œâ”€â”€ lib.rs               # æ¨¡å—å¯¼å‡º
â”‚   â”‚       â”‚   â”œâ”€â”€ convert.rs           # å›¾åƒæ ¼å¼è½¬æ¢
â”‚   â”‚       â”‚   â”‚                        # - OpenCV â†” image-rs
â”‚   â”‚       â”‚   â”‚                        # - TryToCv trait
â”‚   â”‚       â”‚   â””â”€â”€ template_match.rs    # æ¨¡æ¿åŒ¹é… Action
â”‚   â”‚       â”‚                            # - TemplateMatchAction
â”‚   â”‚       â”‚                            # - ScreenshotExt trait
â”‚   â”‚       â”œâ”€â”€ Cargo.toml
â”‚   â”‚       â””â”€â”€ README.md
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ examples/                     # ç¤ºä¾‹ (Phase 2) âœ¨ æ–°å¢
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ ğŸ“¦ cice-integration-vnc-opencv/
â”‚   â”‚       â”œâ”€â”€ examples/
â”‚   â”‚       â”‚   â””â”€â”€ vnc_template_match.rs  # VNC + OpenCV é›†æˆç¤ºä¾‹
â”‚   â”‚       â”œâ”€â”€ Cargo.toml
â”‚   â”‚       â””â”€â”€ README.md
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“¦ dev/                          # å¼€å‘å·¥å…·
â”‚   â”‚   â””â”€â”€ cice-tests-common/           # æµ‹è¯•æ¡†æ¶
â”‚   â”‚       â”œâ”€â”€ src/
â”‚   â”‚       â”‚   â”œâ”€â”€ runtime/             # TestRuntime
â”‚   â”‚       â”‚   â””â”€â”€ action/              # Test Actions
â”‚   â”‚       â””â”€â”€ Cargo.toml
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“¦ cice/                         # ä¸»ç¨‹åº
â”‚   â”œâ”€â”€ ğŸ“¦ cice-debug/                   # è°ƒè¯•å·¥å…·
â”‚   â”œâ”€â”€ ğŸ“¦ cice-lang/                    # è¯­è¨€æ”¯æŒ
â”‚   â”‚
â”‚   â”œâ”€â”€ âš ï¸ cice-controllers/             # æ—§æ¨¡å— (å¾…åˆ é™¤)
â”‚   â”‚   â””â”€â”€ cice-controller-vnc/         # å·²è¿ç§»åˆ° cice-runtime-vnc
â”‚   â”‚
â”‚   â””â”€â”€ âš ï¸ cice-recognizers/             # æ—§æ¨¡å— (å¾…åˆ é™¤)
â”‚       â””â”€â”€ cice-recognizer-opencv/      # å·²è¿ç§»åˆ° cice-action-opencv
â”‚
â”œâ”€â”€ ğŸ“ docs/
â”‚   â””â”€â”€ refactor/
â”‚       â””â”€â”€ controller-recognizer-to-runtime-action/
â”‚           â”œâ”€â”€ ğŸ“„ README.md                    # é‡æ„æ¦‚è¿°
â”‚           â”œâ”€â”€ ğŸ“„ QUICK_REFERENCE.md           # å¿«é€Ÿå‚è€ƒ
â”‚           â”œâ”€â”€ ğŸ“„ TODO.md                      # ä»»åŠ¡æ¸…å•
â”‚           â”‚
â”‚           â”œâ”€â”€ ğŸ“„ PHASE2_REPORT.md             # Phase 2 è¯¦ç»†æŠ¥å‘Š âœ¨
â”‚           â”œâ”€â”€ ğŸ“„ PHASE2_SUMMARY.md            # Phase 2 å®Œæˆæ€»ç»“ âœ¨
â”‚           â”œâ”€â”€ ğŸ“„ PHASE2_COMPLETION.md         # Phase 2 æœ€ç»ˆæŠ¥å‘Š âœ¨
â”‚           â”œâ”€â”€ ğŸ“„ PHASE2_DONE.md               # Phase 2 ç®€æ´æ€»ç»“ âœ¨
â”‚           â”œâ”€â”€ ğŸ“„ GETTING_STARTED.md           # å¿«é€Ÿå¼€å§‹æŒ‡å— âœ¨
â”‚           â””â”€â”€ ğŸ“„ PROJECT_STRUCTURE.md         # é¡¹ç›®ç»“æ„å›¾ âœ¨ (æœ¬æ–‡æ¡£)
â”‚
â””â”€â”€ ğŸ“„ Cargo.toml                        # å·¥ä½œåŒºé…ç½® (å·²æ›´æ–°)
    â””â”€â”€ members:
        â”œâ”€â”€ crates/cice-runtimes/*       âœ¨ æ–°å¢
        â”œâ”€â”€ crates/cice-actions/*        âœ¨ æ–°å¢
        â””â”€â”€ crates/examples/*            âœ¨ æ–°å¢
```

---

## ğŸ“Š æ¨¡å—å…³ç³»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         cice-core                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   Runtime    â”‚  â”‚    Action    â”‚  â”‚   Context    â”‚      â”‚
â”‚  â”‚    trait     â”‚  â”‚    trait     â”‚  â”‚              â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–²                  â–²                  â–²
           â”‚                  â”‚                  â”‚
           â”‚ implements       â”‚ implements       â”‚ uses
           â”‚                  â”‚                  â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
    â”‚             â”‚    â”‚            â”‚    â”‚            â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VncRuntime â”‚ â”‚ TestRuntime â”‚ â”‚ TemplateMatch  â”‚ â”‚ SimpleActionâ”‚
â”‚            â”‚ â”‚             â”‚ â”‚    Action      â”‚ â”‚            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                              â”‚
     â”‚ provides                     â”‚ requires
     â”‚ screenshot                   â”‚ screenshot
     â”‚                              â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              ScreenshotExt
```

---

## ğŸ”„ æ•°æ®æµå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Context   â”‚
â”‚             â”‚
â”‚  - Runtime  â”‚
â”‚  - Actions  â”‚
â”‚  - Tasks    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ run(task_name)
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Task     â”‚
â”‚             â”‚
â”‚  - Config   â”‚
â”‚  - Action   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. recognize()
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Action         â”‚
â”‚                     â”‚
â”‚  - recognize()      â”‚â—„â”€â”€â”€â”€â”€â”
â”‚  - exec()           â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
       â”‚                     â”‚
       â”‚ 2. get_screenshot() â”‚
       â–¼                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚      Runtime        â”‚      â”‚
â”‚                     â”‚      â”‚
â”‚  - screenshot()     â”‚â”€â”€â”€â”€â”€â”€â”˜
â”‚  - click()          â”‚
â”‚  - type_text()      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ æ‰©å±•æœºåˆ¶

### Runtime æ‰©å±•

```rust
// 1. å®šä¹‰æ‰©å±• trait
pub trait ScreenshotExt: Runtime {
    async fn get_screenshot(&self) -> Result<DynamicImage, String>;
}

// 2. Runtime å®ç°æ‰©å±•
impl ScreenshotExt for VncRuntime {
    async fn get_screenshot(&self) -> Result<DynamicImage, String> {
        // å®ç°æˆªå›¾é€»è¾‘
    }
}

// 3. Action ä½¿ç”¨æ‰©å±•
impl<R: ScreenshotExt> Action<R> for TemplateMatchAction {
    async fn recognize(&self, runtime: &R) -> Result<(), RecognizeError> {
        let screenshot = runtime.get_screenshot().await?;
        // ä½¿ç”¨æˆªå›¾è¿›è¡Œè¯†åˆ«
    }
}
```

### ä¼˜åŠ¿

- âœ… **è§£è€¦**: Action ä¸ä¾èµ–å…·ä½“çš„ Runtime
- âœ… **çµæ´»**: ä»»ä½•å®ç°æ‰©å±• trait çš„ Runtime éƒ½å¯ä»¥ä½¿ç”¨
- âœ… **å¯æµ‹è¯•**: æ˜“äºåˆ›å»º mock Runtime
- âœ… **å¯æ‰©å±•**: å¯ä»¥å®šä¹‰æ›´å¤šæ‰©å±• trait

---

## ğŸ“¦ Crate ä¾èµ–å…³ç³»

```
cice-integration-vnc-opencv
    â”œâ”€â”€ cice-runtime-vnc
    â”‚   â””â”€â”€ cice-core
    â””â”€â”€ cice-action-opencv
        â””â”€â”€ cice-core

cice-runtime-vnc
    â””â”€â”€ cice-core

cice-action-opencv
    â””â”€â”€ cice-core

cice-tests-common
    â””â”€â”€ cice-core

cice (ä¸»ç¨‹åº)
    â”œâ”€â”€ cice-core
    â”œâ”€â”€ cice-runtime-vnc
    â””â”€â”€ cice-action-opencv
```

---

## ğŸ—‚ï¸ æ–‡ä»¶ç»Ÿè®¡

### ä»£ç æ–‡ä»¶

| æ¨¡å— | æ–‡ä»¶æ•° | ä»£ç è¡Œæ•° | æµ‹è¯•æ•° |
|------|--------|----------|--------|
| cice-core | ~15 | ~2000 | ~20 |
| cice-runtime-vnc | 3 | ~250 | 4 |
| cice-action-opencv | 5 | ~500 | 2 |
| cice-integration-vnc-opencv | 3 | ~100 | 0 |
| **æ€»è®¡** | **~26** | **~2850** | **~26** |

### æ–‡æ¡£æ–‡ä»¶

| ç±»å‹ | æ•°é‡ | è¯´æ˜ |
|------|------|------|
| æ¨¡å— README | 3 | æ¯ä¸ªæ–°æ¨¡å—éƒ½æœ‰ README |
| é‡æ„æ–‡æ¡£ | 6 | Phase 2 ç›¸å…³æ–‡æ¡£ |
| ç¤ºä¾‹æ–‡æ¡£ | 1 | é›†æˆç¤ºä¾‹è¯´æ˜ |
| **æ€»è®¡** | **10** | **å®Œæ•´çš„æ–‡æ¡£ä½“ç³»** |

---

## ğŸ¨ å‘½åè§„èŒƒ

### Crate å‘½å

- `cice-runtime-*`: Runtime å®ç°
- `cice-action-*`: Action å®ç°
- `cice-integration-*`: é›†æˆç¤ºä¾‹
- `cice-tests-*`: æµ‹è¯•å·¥å…·

### æ¨¡å—å‘½å

- `runtime/`: Runtime ç›¸å…³
- `action/`: Action ç›¸å…³
- `context/`: Context ç›¸å…³
- `task/`: Task ç›¸å…³

### æ–‡ä»¶å‘½å

- `lib.rs`: æ¨¡å—å…¥å£
- `mod.rs`: å­æ¨¡å—å…¥å£
- `*_test.rs`: æµ‹è¯•æ–‡ä»¶
- `README.md`: æ¨¡å—æ–‡æ¡£

---

## ğŸ“ æ€»ç»“

Phase 2 å®Œæˆåï¼Œé¡¹ç›®ç»“æ„æ›´åŠ æ¸…æ™°ï¼š

1. **æ ¸å¿ƒæ¨¡å—** (`cice-core`): å®šä¹‰ Runtime å’Œ Action trait
2. **Runtime å®ç°** (`cice-runtimes/*`): æä¾›å…·ä½“çš„ Runtime
3. **Action å®ç°** (`cice-actions/*`): æä¾›å…·ä½“çš„ Action
4. **é›†æˆç¤ºä¾‹** (`examples/*`): å±•ç¤ºå¦‚ä½•ä½¿ç”¨
5. **æµ‹è¯•å·¥å…·** (`dev/*`): æä¾›æµ‹è¯•æ”¯æŒ

è¿™ç§ç»“æ„å…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š

- âœ… **æ¨¡å—åŒ–**: æ¸…æ™°çš„æ¨¡å—è¾¹ç•Œ
- âœ… **å¯æ‰©å±•**: æ˜“äºæ·»åŠ æ–°çš„ Runtime å’Œ Action
- âœ… **å¯ç»´æŠ¤**: æ¯ä¸ªæ¨¡å—èŒè´£å•ä¸€
- âœ… **å¯æµ‹è¯•**: å®Œå–„çš„æµ‹è¯•æ¡†æ¶

---

**åˆ›å»ºæ—¥æœŸ**: 2025-11-24
**ç‰ˆæœ¬**: v1.0
